{"ast":null,"code":"/**\n * @file Web Cryptography API shim\n * @author Artem S Vybornov <vybornov@gmail.com>\n * @license MIT\n */\nmodule.exports = function webcryptoShim(global) {\n  'use strict';\n\n  if (typeof Promise !== 'function') throw \"Promise support required\";\n\n  var _crypto = global.crypto || global.msCrypto;\n\n  if (!_crypto) return;\n\n  var _subtle = _crypto.subtle || _crypto.webkitSubtle;\n\n  if (!_subtle) return;\n\n  var _Crypto = global.Crypto || _crypto.constructor || Object,\n      _SubtleCrypto = global.SubtleCrypto || _subtle.constructor || Object,\n      _CryptoKey = global.CryptoKey || global.Key || Object;\n\n  var isEdge = global.navigator.userAgent.indexOf('Edge/') > -1;\n  var isIE = !!global.msCrypto && !isEdge,\n      isWebkit = !_crypto.subtle && !!_crypto.webkitSubtle;\n  if (!isIE && !isWebkit) return;\n\n  function s2a(s) {\n    return btoa(s).replace(/\\=+$/, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n  }\n\n  function a2s(s) {\n    s += '===', s = s.slice(0, -s.length % 4);\n    return atob(s.replace(/-/g, '+').replace(/_/g, '/'));\n  }\n\n  function s2b(s) {\n    var b = new Uint8Array(s.length);\n\n    for (var i = 0; i < s.length; i++) b[i] = s.charCodeAt(i);\n\n    return b;\n  }\n\n  function b2s(b) {\n    if (b instanceof ArrayBuffer) b = new Uint8Array(b);\n    return String.fromCharCode.apply(String, b);\n  }\n\n  function alg(a) {\n    var r = {\n      'name': (a.name || a || '').toUpperCase().replace('V', 'v')\n    };\n\n    switch (r.name) {\n      case 'SHA-1':\n      case 'SHA-256':\n      case 'SHA-384':\n      case 'SHA-512':\n        break;\n\n      case 'AES-CBC':\n      case 'AES-GCM':\n      case 'AES-KW':\n        if (a.length) r['length'] = a.length;\n        break;\n\n      case 'HMAC':\n        if (a.hash) r['hash'] = alg(a.hash);\n        if (a.length) r['length'] = a.length;\n        break;\n\n      case 'RSAES-PKCS1-v1_5':\n        if (a.publicExponent) r['publicExponent'] = new Uint8Array(a.publicExponent);\n        if (a.modulusLength) r['modulusLength'] = a.modulusLength;\n        break;\n\n      case 'RSASSA-PKCS1-v1_5':\n      case 'RSA-OAEP':\n        if (a.hash) r['hash'] = alg(a.hash);\n        if (a.publicExponent) r['publicExponent'] = new Uint8Array(a.publicExponent);\n        if (a.modulusLength) r['modulusLength'] = a.modulusLength;\n        break;\n\n      default:\n        throw new SyntaxError(\"Bad algorithm name\");\n    }\n\n    return r;\n  }\n\n  ;\n\n  function jwkAlg(a) {\n    return {\n      'HMAC': {\n        'SHA-1': 'HS1',\n        'SHA-256': 'HS256',\n        'SHA-384': 'HS384',\n        'SHA-512': 'HS512'\n      },\n      'RSASSA-PKCS1-v1_5': {\n        'SHA-1': 'RS1',\n        'SHA-256': 'RS256',\n        'SHA-384': 'RS384',\n        'SHA-512': 'RS512'\n      },\n      'RSAES-PKCS1-v1_5': {\n        '': 'RSA1_5'\n      },\n      'RSA-OAEP': {\n        'SHA-1': 'RSA-OAEP',\n        'SHA-256': 'RSA-OAEP-256'\n      },\n      'AES-KW': {\n        '128': 'A128KW',\n        '192': 'A192KW',\n        '256': 'A256KW'\n      },\n      'AES-GCM': {\n        '128': 'A128GCM',\n        '192': 'A192GCM',\n        '256': 'A256GCM'\n      },\n      'AES-CBC': {\n        '128': 'A128CBC',\n        '192': 'A192CBC',\n        '256': 'A256CBC'\n      }\n    }[a.name][(a.hash || {}).name || a.length || ''];\n  }\n\n  function b2jwk(k) {\n    if (k instanceof ArrayBuffer || k instanceof Uint8Array) k = JSON.parse(decodeURIComponent(escape(b2s(k))));\n    var jwk = {\n      'kty': k.kty,\n      'alg': k.alg,\n      'ext': k.ext || k.extractable\n    };\n\n    switch (jwk.kty) {\n      case 'oct':\n        jwk.k = k.k;\n\n      case 'RSA':\n        ['n', 'e', 'd', 'p', 'q', 'dp', 'dq', 'qi', 'oth'].forEach(function (x) {\n          if (x in k) jwk[x] = k[x];\n        });\n        break;\n\n      default:\n        throw new TypeError(\"Unsupported key type\");\n    }\n\n    return jwk;\n  }\n\n  function jwk2b(k) {\n    var jwk = b2jwk(k);\n    if (isIE) jwk['extractable'] = jwk.ext, delete jwk.ext;\n    return s2b(unescape(encodeURIComponent(JSON.stringify(jwk)))).buffer;\n  }\n\n  function pkcs2jwk(k) {\n    var info = b2der(k),\n        prv = false;\n    if (info.length > 2) prv = true, info.shift(); // remove version from PKCS#8 PrivateKeyInfo structure\n\n    var jwk = {\n      'ext': true\n    };\n\n    switch (info[0][0]) {\n      case '1.2.840.113549.1.1.1':\n        var rsaComp = ['n', 'e', 'd', 'p', 'q', 'dp', 'dq', 'qi'],\n            rsaKey = b2der(info[1]);\n        if (prv) rsaKey.shift(); // remove version from PKCS#1 RSAPrivateKey structure\n\n        for (var i = 0; i < rsaKey.length; i++) {\n          if (!rsaKey[i][0]) rsaKey[i] = rsaKey[i].subarray(1);\n          jwk[rsaComp[i]] = s2a(b2s(rsaKey[i]));\n        }\n\n        jwk['kty'] = 'RSA';\n        break;\n\n      default:\n        throw new TypeError(\"Unsupported key type\");\n    }\n\n    return jwk;\n  }\n\n  function jwk2pkcs(k) {\n    var key,\n        info = [['', null]],\n        prv = false;\n\n    switch (k.kty) {\n      case 'RSA':\n        var rsaComp = ['n', 'e', 'd', 'p', 'q', 'dp', 'dq', 'qi'],\n            rsaKey = [];\n\n        for (var i = 0; i < rsaComp.length; i++) {\n          if (!(rsaComp[i] in k)) break;\n          var b = rsaKey[i] = s2b(a2s(k[rsaComp[i]]));\n          if (b[0] & 0x80) rsaKey[i] = new Uint8Array(b.length + 1), rsaKey[i].set(b, 1);\n        }\n\n        if (rsaKey.length > 2) prv = true, rsaKey.unshift(new Uint8Array([0])); // add version to PKCS#1 RSAPrivateKey structure\n\n        info[0][0] = '1.2.840.113549.1.1.1';\n        key = rsaKey;\n        break;\n\n      default:\n        throw new TypeError(\"Unsupported key type\");\n    }\n\n    info.push(new Uint8Array(der2b(key)).buffer);\n    if (!prv) info[1] = {\n      'tag': 0x03,\n      'value': info[1]\n    };else info.unshift(new Uint8Array([0])); // add version to PKCS#8 PrivateKeyInfo structure\n\n    return new Uint8Array(der2b(info)).buffer;\n  }\n\n  var oid2str = {\n    'KoZIhvcNAQEB': '1.2.840.113549.1.1.1'\n  },\n      str2oid = {\n    '1.2.840.113549.1.1.1': 'KoZIhvcNAQEB'\n  };\n\n  function b2der(buf, ctx) {\n    if (buf instanceof ArrayBuffer) buf = new Uint8Array(buf);\n    if (!ctx) ctx = {\n      pos: 0,\n      end: buf.length\n    };\n    if (ctx.end - ctx.pos < 2 || ctx.end > buf.length) throw new RangeError(\"Malformed DER\");\n    var tag = buf[ctx.pos++],\n        len = buf[ctx.pos++];\n\n    if (len >= 0x80) {\n      len &= 0x7f;\n      if (ctx.end - ctx.pos < len) throw new RangeError(\"Malformed DER\");\n\n      for (var xlen = 0; len--;) xlen <<= 8, xlen |= buf[ctx.pos++];\n\n      len = xlen;\n    }\n\n    if (ctx.end - ctx.pos < len) throw new RangeError(\"Malformed DER\");\n    var rv;\n\n    switch (tag) {\n      case 0x02:\n        // Universal Primitive INTEGER\n        rv = buf.subarray(ctx.pos, ctx.pos += len);\n        break;\n\n      case 0x03:\n        // Universal Primitive BIT STRING\n        if (buf[ctx.pos++]) throw new Error(\"Unsupported bit string\");\n        len--;\n\n      case 0x04:\n        // Universal Primitive OCTET STRING\n        rv = new Uint8Array(buf.subarray(ctx.pos, ctx.pos += len)).buffer;\n        break;\n\n      case 0x05:\n        // Universal Primitive NULL\n        rv = null;\n        break;\n\n      case 0x06:\n        // Universal Primitive OBJECT IDENTIFIER\n        var oid = btoa(b2s(buf.subarray(ctx.pos, ctx.pos += len)));\n        if (!(oid in oid2str)) throw new Error(\"Unsupported OBJECT ID \" + oid);\n        rv = oid2str[oid];\n        break;\n\n      case 0x30:\n        // Universal Constructed SEQUENCE\n        rv = [];\n\n        for (var end = ctx.pos + len; ctx.pos < end;) rv.push(b2der(buf, ctx));\n\n        break;\n\n      default:\n        throw new Error(\"Unsupported DER tag 0x\" + tag.toString(16));\n    }\n\n    return rv;\n  }\n\n  function der2b(val, buf) {\n    if (!buf) buf = [];\n    var tag = 0,\n        len = 0,\n        pos = buf.length + 2;\n    buf.push(0, 0); // placeholder\n\n    if (val instanceof Uint8Array) {\n      // Universal Primitive INTEGER\n      tag = 0x02, len = val.length;\n\n      for (var i = 0; i < len; i++) buf.push(val[i]);\n    } else if (val instanceof ArrayBuffer) {\n      // Universal Primitive OCTET STRING\n      tag = 0x04, len = val.byteLength, val = new Uint8Array(val);\n\n      for (var i = 0; i < len; i++) buf.push(val[i]);\n    } else if (val === null) {\n      // Universal Primitive NULL\n      tag = 0x05, len = 0;\n    } else if (typeof val === 'string' && val in str2oid) {\n      // Universal Primitive OBJECT IDENTIFIER\n      var oid = s2b(atob(str2oid[val]));\n      tag = 0x06, len = oid.length;\n\n      for (var i = 0; i < len; i++) buf.push(oid[i]);\n    } else if (val instanceof Array) {\n      // Universal Constructed SEQUENCE\n      for (var i = 0; i < val.length; i++) der2b(val[i], buf);\n\n      tag = 0x30, len = buf.length - pos;\n    } else if (typeof val === 'object' && val.tag === 0x03 && val.value instanceof ArrayBuffer) {\n      // Tag hint\n      val = new Uint8Array(val.value), tag = 0x03, len = val.byteLength;\n      buf.push(0);\n\n      for (var i = 0; i < len; i++) buf.push(val[i]);\n\n      len++;\n    } else {\n      throw new Error(\"Unsupported DER value \" + val);\n    }\n\n    if (len >= 0x80) {\n      var xlen = len,\n          len = 4;\n      buf.splice(pos, 0, xlen >> 24 & 0xff, xlen >> 16 & 0xff, xlen >> 8 & 0xff, xlen & 0xff);\n\n      while (len > 1 && !(xlen >> 24)) xlen <<= 8, len--;\n\n      if (len < 4) buf.splice(pos, 4 - len);\n      len |= 0x80;\n    }\n\n    buf.splice(pos - 2, 2, tag, len);\n    return buf;\n  }\n\n  function CryptoKey(key, alg, ext, use) {\n    Object.defineProperties(this, {\n      _key: {\n        value: key\n      },\n      type: {\n        value: key.type,\n        enumerable: true\n      },\n      extractable: {\n        value: ext === undefined ? key.extractable : ext,\n        enumerable: true\n      },\n      algorithm: {\n        value: alg === undefined ? key.algorithm : alg,\n        enumerable: true\n      },\n      usages: {\n        value: use === undefined ? key.usages : use,\n        enumerable: true\n      }\n    });\n  }\n\n  function isPubKeyUse(u) {\n    return u === 'verify' || u === 'encrypt' || u === 'wrapKey';\n  }\n\n  function isPrvKeyUse(u) {\n    return u === 'sign' || u === 'decrypt' || u === 'unwrapKey';\n  }\n\n  ['generateKey', 'importKey', 'unwrapKey'].forEach(function (m) {\n    var _fn = _subtle[m];\n\n    _subtle[m] = function (a, b, c) {\n      var args = [].slice.call(arguments),\n          ka,\n          kx,\n          ku;\n\n      switch (m) {\n        case 'generateKey':\n          ka = alg(a), kx = b, ku = c;\n          break;\n\n        case 'importKey':\n          ka = alg(c), kx = args[3], ku = args[4];\n\n          if (a === 'jwk') {\n            b = b2jwk(b);\n            if (!b.alg) b.alg = jwkAlg(ka);\n            if (!b.key_ops) b.key_ops = b.kty !== 'oct' ? 'd' in b ? ku.filter(isPrvKeyUse) : ku.filter(isPubKeyUse) : ku.slice();\n            args[1] = jwk2b(b);\n          }\n\n          break;\n\n        case 'unwrapKey':\n          ka = args[4], kx = args[5], ku = args[6];\n          args[2] = c._key;\n          break;\n      }\n\n      if (m === 'generateKey' && ka.name === 'HMAC' && ka.hash) {\n        ka.length = ka.length || {\n          'SHA-1': 512,\n          'SHA-256': 512,\n          'SHA-384': 1024,\n          'SHA-512': 1024\n        }[ka.hash.name];\n        return _subtle.importKey('raw', _crypto.getRandomValues(new Uint8Array(ka.length + 7 >> 3)), ka, kx, ku);\n      }\n\n      if (isWebkit && m === 'generateKey' && ka.name === 'RSASSA-PKCS1-v1_5' && (!ka.modulusLength || ka.modulusLength >= 2048)) {\n        a = alg(a), a.name = 'RSAES-PKCS1-v1_5', delete a.hash;\n        return _subtle.generateKey(a, true, ['encrypt', 'decrypt']).then(function (k) {\n          return Promise.all([_subtle.exportKey('jwk', k.publicKey), _subtle.exportKey('jwk', k.privateKey)]);\n        }).then(function (keys) {\n          keys[0].alg = keys[1].alg = jwkAlg(ka);\n          keys[0].key_ops = ku.filter(isPubKeyUse), keys[1].key_ops = ku.filter(isPrvKeyUse);\n          return Promise.all([_subtle.importKey('jwk', keys[0], ka, true, keys[0].key_ops), _subtle.importKey('jwk', keys[1], ka, kx, keys[1].key_ops)]);\n        }).then(function (keys) {\n          return {\n            publicKey: keys[0],\n            privateKey: keys[1]\n          };\n        });\n      }\n\n      if ((isWebkit || isIE && (ka.hash || {}).name === 'SHA-1') && m === 'importKey' && a === 'jwk' && ka.name === 'HMAC' && b.kty === 'oct') {\n        return _subtle.importKey('raw', s2b(a2s(b.k)), c, args[3], args[4]);\n      }\n\n      if (isWebkit && m === 'importKey' && (a === 'spki' || a === 'pkcs8')) {\n        return _subtle.importKey('jwk', pkcs2jwk(b), c, args[3], args[4]);\n      }\n\n      if (isIE && m === 'unwrapKey') {\n        return _subtle.decrypt(args[3], c, b).then(function (k) {\n          return _subtle.importKey(a, k, args[4], args[5], args[6]);\n        });\n      }\n\n      var op;\n\n      try {\n        op = _fn.apply(_subtle, args);\n      } catch (e) {\n        return Promise.reject(e);\n      }\n\n      if (isIE) {\n        op = new Promise(function (res, rej) {\n          op.onabort = op.onerror = function (e) {\n            rej(e);\n          };\n\n          op.oncomplete = function (r) {\n            res(r.target.result);\n          };\n        });\n      }\n\n      op = op.then(function (k) {\n        if (ka.name === 'HMAC') {\n          if (!ka.length) ka.length = 8 * k.algorithm.length;\n        }\n\n        if (ka.name.search('RSA') == 0) {\n          if (!ka.modulusLength) ka.modulusLength = (k.publicKey || k).algorithm.modulusLength;\n          if (!ka.publicExponent) ka.publicExponent = (k.publicKey || k).algorithm.publicExponent;\n        }\n\n        if (k.publicKey && k.privateKey) {\n          k = {\n            publicKey: new CryptoKey(k.publicKey, ka, kx, ku.filter(isPubKeyUse)),\n            privateKey: new CryptoKey(k.privateKey, ka, kx, ku.filter(isPrvKeyUse))\n          };\n        } else {\n          k = new CryptoKey(k, ka, kx, ku);\n        }\n\n        return k;\n      });\n      return op;\n    };\n  });\n  ['exportKey', 'wrapKey'].forEach(function (m) {\n    var _fn = _subtle[m];\n\n    _subtle[m] = function (a, b, c) {\n      var args = [].slice.call(arguments);\n\n      switch (m) {\n        case 'exportKey':\n          args[1] = b._key;\n          break;\n\n        case 'wrapKey':\n          args[1] = b._key, args[2] = c._key;\n          break;\n      }\n\n      if ((isWebkit || isIE && (b.algorithm.hash || {}).name === 'SHA-1') && m === 'exportKey' && a === 'jwk' && b.algorithm.name === 'HMAC') {\n        args[0] = 'raw';\n      }\n\n      if (isWebkit && m === 'exportKey' && (a === 'spki' || a === 'pkcs8')) {\n        args[0] = 'jwk';\n      }\n\n      if (isIE && m === 'wrapKey') {\n        return _subtle.exportKey(a, b).then(function (k) {\n          if (a === 'jwk') k = s2b(unescape(encodeURIComponent(JSON.stringify(b2jwk(k)))));\n          return _subtle.encrypt(args[3], c, k);\n        });\n      }\n\n      var op;\n\n      try {\n        op = _fn.apply(_subtle, args);\n      } catch (e) {\n        return Promise.reject(e);\n      }\n\n      if (isIE) {\n        op = new Promise(function (res, rej) {\n          op.onabort = op.onerror = function (e) {\n            rej(e);\n          };\n\n          op.oncomplete = function (r) {\n            res(r.target.result);\n          };\n        });\n      }\n\n      if (m === 'exportKey' && a === 'jwk') {\n        op = op.then(function (k) {\n          if ((isWebkit || isIE && (b.algorithm.hash || {}).name === 'SHA-1') && b.algorithm.name === 'HMAC') {\n            return {\n              'kty': 'oct',\n              'alg': jwkAlg(b.algorithm),\n              'key_ops': b.usages.slice(),\n              'ext': true,\n              'k': s2a(b2s(k))\n            };\n          }\n\n          k = b2jwk(k);\n          if (!k.alg) k['alg'] = jwkAlg(b.algorithm);\n          if (!k.key_ops) k['key_ops'] = b.type === 'public' ? b.usages.filter(isPubKeyUse) : b.type === 'private' ? b.usages.filter(isPrvKeyUse) : b.usages.slice();\n          return k;\n        });\n      }\n\n      if (isWebkit && m === 'exportKey' && (a === 'spki' || a === 'pkcs8')) {\n        op = op.then(function (k) {\n          k = jwk2pkcs(b2jwk(k));\n          return k;\n        });\n      }\n\n      return op;\n    };\n  });\n  ['encrypt', 'decrypt', 'sign', 'verify'].forEach(function (m) {\n    var _fn = _subtle[m];\n\n    _subtle[m] = function (a, b, c, d) {\n      if (isIE && (!c.byteLength || d && !d.byteLength)) throw new Error(\"Empy input is not allowed\");\n      var args = [].slice.call(arguments),\n          ka = alg(a);\n\n      if (isIE && m === 'decrypt' && ka.name === 'AES-GCM') {\n        var tl = a.tagLength >> 3;\n        args[2] = (c.buffer || c).slice(0, c.byteLength - tl), a.tag = (c.buffer || c).slice(c.byteLength - tl);\n      }\n\n      args[1] = b._key;\n      var op;\n\n      try {\n        op = _fn.apply(_subtle, args);\n      } catch (e) {\n        return Promise.reject(e);\n      }\n\n      if (isIE) {\n        op = new Promise(function (res, rej) {\n          op.onabort = op.onerror = function (e) {\n            rej(e);\n          };\n\n          op.oncomplete = function (r) {\n            var r = r.target.result;\n\n            if (m === 'encrypt' && r instanceof AesGcmEncryptResult) {\n              var c = r.ciphertext,\n                  t = r.tag;\n              r = new Uint8Array(c.byteLength + t.byteLength);\n              r.set(new Uint8Array(c), 0);\n              r.set(new Uint8Array(t), c.byteLength);\n              r = r.buffer;\n            }\n\n            res(r);\n          };\n        });\n      }\n\n      return op;\n    };\n  });\n\n  if (isIE) {\n    var _digest = _subtle.digest;\n\n    _subtle['digest'] = function (a, b) {\n      if (!b.byteLength) throw new Error(\"Empy input is not allowed\");\n      var op;\n\n      try {\n        op = _digest.call(_subtle, a, b);\n      } catch (e) {\n        return Promise.reject(e);\n      }\n\n      op = new Promise(function (res, rej) {\n        op.onabort = op.onerror = function (e) {\n          rej(e);\n        };\n\n        op.oncomplete = function (r) {\n          res(r.target.result);\n        };\n      });\n      return op;\n    };\n\n    global.crypto = Object.create(_crypto, {\n      getRandomValues: {\n        value: function (a) {\n          return _crypto.getRandomValues(a);\n        }\n      },\n      subtle: {\n        value: _subtle\n      }\n    });\n    global.CryptoKey = CryptoKey;\n  }\n\n  if (isWebkit) {\n    _crypto.subtle = _subtle;\n    global.Crypto = _Crypto;\n    global.SubtleCrypto = _SubtleCrypto;\n    global.CryptoKey = CryptoKey;\n  }\n};","map":{"version":3,"sources":["/home/ranju/location/meDossier/frontend/node_modules/webcrypto-shim/webcrypto-shim.js"],"names":["module","exports","webcryptoShim","global","Promise","_crypto","crypto","msCrypto","_subtle","subtle","webkitSubtle","_Crypto","Crypto","constructor","Object","_SubtleCrypto","SubtleCrypto","_CryptoKey","CryptoKey","Key","isEdge","navigator","userAgent","indexOf","isIE","isWebkit","s2a","s","btoa","replace","a2s","slice","length","atob","s2b","b","Uint8Array","i","charCodeAt","b2s","ArrayBuffer","String","fromCharCode","apply","alg","a","r","name","toUpperCase","hash","publicExponent","modulusLength","SyntaxError","jwkAlg","b2jwk","k","JSON","parse","decodeURIComponent","escape","jwk","kty","ext","extractable","forEach","x","TypeError","jwk2b","unescape","encodeURIComponent","stringify","buffer","pkcs2jwk","info","b2der","prv","shift","rsaComp","rsaKey","subarray","jwk2pkcs","key","set","unshift","push","der2b","oid2str","str2oid","buf","ctx","pos","end","RangeError","tag","len","xlen","rv","Error","oid","toString","val","byteLength","Array","value","splice","use","defineProperties","_key","type","enumerable","undefined","algorithm","usages","isPubKeyUse","u","isPrvKeyUse","m","_fn","c","args","call","arguments","ka","kx","ku","key_ops","filter","importKey","getRandomValues","generateKey","then","all","exportKey","publicKey","privateKey","keys","decrypt","op","e","reject","res","rej","onabort","onerror","oncomplete","target","result","search","encrypt","d","tl","tagLength","AesGcmEncryptResult","ciphertext","t","_digest","digest","create"],"mappings":"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","sourcesContent":["/**\n * @file Web Cryptography API shim\n * @author Artem S Vybornov <vybornov@gmail.com>\n * @license MIT\n */\nmodule.exports = function webcryptoShim (global) {\n    'use strict';\n\n    if ( typeof Promise !== 'function' )\n        throw \"Promise support required\";\n\n    var _crypto = global.crypto || global.msCrypto;\n    if ( !_crypto ) return;\n\n    var _subtle = _crypto.subtle || _crypto.webkitSubtle;\n    if ( !_subtle ) return;\n\n    var _Crypto     = global.Crypto || _crypto.constructor || Object,\n        _SubtleCrypto = global.SubtleCrypto || _subtle.constructor || Object,\n        _CryptoKey  = global.CryptoKey || global.Key || Object;\n\n    var isEdge = global.navigator.userAgent.indexOf('Edge/') > -1\n    var isIE    = !!global.msCrypto && !isEdge,\n        isWebkit = !_crypto.subtle && !!_crypto.webkitSubtle;\n    if ( !isIE && !isWebkit ) return;\n\n    function s2a ( s ) {\n        return btoa(s).replace(/\\=+$/, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n    }\n\n    function a2s ( s ) {\n        s += '===', s = s.slice( 0, -s.length % 4 );\n        return atob( s.replace(/-/g, '+').replace(/_/g, '/') );\n    }\n\n    function s2b ( s ) {\n        var b = new Uint8Array(s.length);\n        for ( var i = 0; i < s.length; i++ ) b[i] = s.charCodeAt(i);\n        return b;\n    }\n\n    function b2s ( b ) {\n        if ( b instanceof ArrayBuffer ) b = new Uint8Array(b);\n        return String.fromCharCode.apply( String, b );\n    }\n\n    function alg ( a ) {\n        var r = { 'name': (a.name || a || '').toUpperCase().replace('V','v') };\n        switch ( r.name ) {\n            case 'SHA-1':\n            case 'SHA-256':\n            case 'SHA-384':\n            case 'SHA-512':\n                break;\n            case 'AES-CBC':\n            case 'AES-GCM':\n            case 'AES-KW':\n                if ( a.length ) r['length'] = a.length;\n                break;\n            case 'HMAC':\n                if ( a.hash ) r['hash'] = alg(a.hash);\n                if ( a.length ) r['length'] = a.length;\n                break;\n            case 'RSAES-PKCS1-v1_5':\n                if ( a.publicExponent ) r['publicExponent'] = new Uint8Array(a.publicExponent);\n                if ( a.modulusLength ) r['modulusLength'] = a.modulusLength;\n                break;\n            case 'RSASSA-PKCS1-v1_5':\n            case 'RSA-OAEP':\n                if ( a.hash ) r['hash'] = alg(a.hash);\n                if ( a.publicExponent ) r['publicExponent'] = new Uint8Array(a.publicExponent);\n                if ( a.modulusLength ) r['modulusLength'] = a.modulusLength;\n                break;\n            default:\n                throw new SyntaxError(\"Bad algorithm name\");\n        }\n        return r;\n    };\n\n    function jwkAlg ( a ) {\n        return {\n            'HMAC': {\n                'SHA-1': 'HS1',\n                'SHA-256': 'HS256',\n                'SHA-384': 'HS384',\n                'SHA-512': 'HS512',\n            },\n            'RSASSA-PKCS1-v1_5': {\n                'SHA-1': 'RS1',\n                'SHA-256': 'RS256',\n                'SHA-384': 'RS384',\n                'SHA-512': 'RS512',\n            },\n            'RSAES-PKCS1-v1_5': {\n                '': 'RSA1_5',\n            },\n            'RSA-OAEP': {\n                'SHA-1': 'RSA-OAEP',\n                'SHA-256': 'RSA-OAEP-256',\n            },\n            'AES-KW': {\n                '128': 'A128KW',\n                '192': 'A192KW',\n                '256': 'A256KW',\n            },\n            'AES-GCM': {\n                '128': 'A128GCM',\n                '192': 'A192GCM',\n                '256': 'A256GCM',\n            },\n            'AES-CBC': {\n                '128': 'A128CBC',\n                '192': 'A192CBC',\n                '256': 'A256CBC',\n            },\n        }[a.name][ ( a.hash || {} ).name || a.length || '' ];\n    }\n\n    function b2jwk ( k ) {\n        if ( k instanceof ArrayBuffer || k instanceof Uint8Array ) k = JSON.parse( decodeURIComponent( escape( b2s(k) ) ) );\n        var jwk = { 'kty': k.kty, 'alg': k.alg, 'ext': k.ext || k.extractable };\n        switch ( jwk.kty ) {\n            case 'oct':\n                jwk.k = k.k;\n            case 'RSA':\n                [ 'n', 'e', 'd', 'p', 'q', 'dp', 'dq', 'qi', 'oth' ].forEach( function ( x ) { if ( x in k ) jwk[x] = k[x] } );\n                break;\n            default:\n                throw new TypeError(\"Unsupported key type\");\n        }\n        return jwk;\n    }\n\n    function jwk2b ( k ) {\n        var jwk = b2jwk(k);\n        if ( isIE ) jwk['extractable'] = jwk.ext, delete jwk.ext;\n        return s2b( unescape( encodeURIComponent( JSON.stringify(jwk) ) ) ).buffer;\n    }\n\n    function pkcs2jwk ( k ) {\n        var info = b2der(k), prv = false;\n        if ( info.length > 2 ) prv = true, info.shift(); // remove version from PKCS#8 PrivateKeyInfo structure\n        var jwk = { 'ext': true };\n        switch ( info[0][0] ) {\n            case '1.2.840.113549.1.1.1':\n                var rsaComp = [ 'n', 'e', 'd', 'p', 'q', 'dp', 'dq', 'qi' ],\n                    rsaKey  = b2der( info[1] );\n                if ( prv ) rsaKey.shift(); // remove version from PKCS#1 RSAPrivateKey structure\n                for ( var i = 0; i < rsaKey.length; i++ ) {\n                    if ( !rsaKey[i][0] ) rsaKey[i] = rsaKey[i].subarray(1);\n                    jwk[ rsaComp[i] ] = s2a( b2s( rsaKey[i] ) );\n                }\n                jwk['kty'] = 'RSA';\n                break;\n            default:\n                throw new TypeError(\"Unsupported key type\");\n        }\n        return jwk;\n    }\n\n    function jwk2pkcs ( k ) {\n        var key, info = [ [ '', null ] ], prv = false;\n        switch ( k.kty ) {\n            case 'RSA':\n                var rsaComp = [ 'n', 'e', 'd', 'p', 'q', 'dp', 'dq', 'qi' ],\n                    rsaKey = [];\n                for ( var i = 0; i < rsaComp.length; i++ ) {\n                    if ( !( rsaComp[i] in k ) ) break;\n                    var b = rsaKey[i] = s2b( a2s( k[ rsaComp[i] ] ) );\n                    if ( b[0] & 0x80 ) rsaKey[i] = new Uint8Array(b.length + 1), rsaKey[i].set( b, 1 );\n                }\n                if ( rsaKey.length > 2 ) prv = true, rsaKey.unshift( new Uint8Array([0]) ); // add version to PKCS#1 RSAPrivateKey structure\n                info[0][0] = '1.2.840.113549.1.1.1';\n                key = rsaKey;\n                break;\n            default:\n                throw new TypeError(\"Unsupported key type\");\n        }\n        info.push( new Uint8Array( der2b(key) ).buffer );\n        if ( !prv ) info[1] = { 'tag': 0x03, 'value': info[1] };\n        else info.unshift( new Uint8Array([0]) ); // add version to PKCS#8 PrivateKeyInfo structure\n        return new Uint8Array( der2b(info) ).buffer;\n    }\n\n    var oid2str = { 'KoZIhvcNAQEB': '1.2.840.113549.1.1.1' },\n        str2oid = { '1.2.840.113549.1.1.1': 'KoZIhvcNAQEB' };\n\n    function b2der ( buf, ctx ) {\n        if ( buf instanceof ArrayBuffer ) buf = new Uint8Array(buf);\n        if ( !ctx ) ctx = { pos: 0, end: buf.length };\n\n        if ( ctx.end - ctx.pos < 2 || ctx.end > buf.length ) throw new RangeError(\"Malformed DER\");\n\n        var tag = buf[ctx.pos++],\n            len = buf[ctx.pos++];\n\n        if ( len >= 0x80 ) {\n            len &= 0x7f;\n            if ( ctx.end - ctx.pos < len ) throw new RangeError(\"Malformed DER\");\n            for ( var xlen = 0; len--; ) xlen <<= 8, xlen |= buf[ctx.pos++];\n            len = xlen;\n        }\n\n        if ( ctx.end - ctx.pos < len ) throw new RangeError(\"Malformed DER\");\n\n        var rv;\n\n        switch ( tag ) {\n            case 0x02: // Universal Primitive INTEGER\n                rv = buf.subarray( ctx.pos, ctx.pos += len );\n                break;\n            case 0x03: // Universal Primitive BIT STRING\n                if ( buf[ctx.pos++] ) throw new Error( \"Unsupported bit string\" );\n                len--;\n            case 0x04: // Universal Primitive OCTET STRING\n                rv = new Uint8Array( buf.subarray( ctx.pos, ctx.pos += len ) ).buffer;\n                break;\n            case 0x05: // Universal Primitive NULL\n                rv = null;\n                break;\n            case 0x06: // Universal Primitive OBJECT IDENTIFIER\n                var oid = btoa( b2s( buf.subarray( ctx.pos, ctx.pos += len ) ) );\n                if ( !( oid in oid2str ) ) throw new Error( \"Unsupported OBJECT ID \" + oid );\n                rv = oid2str[oid];\n                break;\n            case 0x30: // Universal Constructed SEQUENCE\n                rv = [];\n                for ( var end = ctx.pos + len; ctx.pos < end; ) rv.push( b2der( buf, ctx ) );\n                break;\n            default:\n                throw new Error( \"Unsupported DER tag 0x\" + tag.toString(16) );\n        }\n\n        return rv;\n    }\n\n    function der2b ( val, buf ) {\n        if ( !buf ) buf = [];\n\n        var tag = 0, len = 0,\n            pos = buf.length + 2;\n\n        buf.push( 0, 0 ); // placeholder\n\n        if ( val instanceof Uint8Array ) {  // Universal Primitive INTEGER\n            tag = 0x02, len = val.length;\n            for ( var i = 0; i < len; i++ ) buf.push( val[i] );\n        }\n        else if ( val instanceof ArrayBuffer ) { // Universal Primitive OCTET STRING\n            tag = 0x04, len = val.byteLength, val = new Uint8Array(val);\n            for ( var i = 0; i < len; i++ ) buf.push( val[i] );\n        }\n        else if ( val === null ) { // Universal Primitive NULL\n            tag = 0x05, len = 0;\n        }\n        else if ( typeof val === 'string' && val in str2oid ) { // Universal Primitive OBJECT IDENTIFIER\n            var oid = s2b( atob( str2oid[val] ) );\n            tag = 0x06, len = oid.length;\n            for ( var i = 0; i < len; i++ ) buf.push( oid[i] );\n        }\n        else if ( val instanceof Array ) { // Universal Constructed SEQUENCE\n            for ( var i = 0; i < val.length; i++ ) der2b( val[i], buf );\n            tag = 0x30, len = buf.length - pos;\n        }\n        else if ( typeof val === 'object' && val.tag === 0x03 && val.value instanceof ArrayBuffer ) { // Tag hint\n            val = new Uint8Array(val.value), tag = 0x03, len = val.byteLength;\n            buf.push(0); for ( var i = 0; i < len; i++ ) buf.push( val[i] );\n            len++;\n        }\n        else {\n            throw new Error( \"Unsupported DER value \" + val );\n        }\n\n        if ( len >= 0x80 ) {\n            var xlen = len, len = 4;\n            buf.splice( pos, 0, (xlen >> 24) & 0xff, (xlen >> 16) & 0xff, (xlen >> 8) & 0xff, xlen & 0xff );\n            while ( len > 1 && !(xlen >> 24) ) xlen <<= 8, len--;\n            if ( len < 4 ) buf.splice( pos, 4 - len );\n            len |= 0x80;\n        }\n\n        buf.splice( pos - 2, 2, tag, len );\n\n        return buf;\n    }\n\n    function CryptoKey ( key, alg, ext, use ) {\n        Object.defineProperties( this, {\n            _key: {\n                value: key\n            },\n            type: {\n                value: key.type,\n                enumerable: true,\n            },\n            extractable: {\n                value: (ext === undefined) ? key.extractable : ext,\n                enumerable: true,\n            },\n            algorithm: {\n                value: (alg === undefined) ? key.algorithm : alg,\n                enumerable: true,\n            },\n            usages: {\n                value: (use === undefined) ? key.usages : use,\n                enumerable: true,\n            },\n        });\n    }\n\n    function isPubKeyUse ( u ) {\n        return u === 'verify' || u === 'encrypt' || u === 'wrapKey';\n    }\n\n    function isPrvKeyUse ( u ) {\n        return u === 'sign' || u === 'decrypt' || u === 'unwrapKey';\n    }\n\n    [ 'generateKey', 'importKey', 'unwrapKey' ]\n        .forEach( function ( m ) {\n            var _fn = _subtle[m];\n\n            _subtle[m] = function ( a, b, c ) {\n                var args = [].slice.call(arguments),\n                    ka, kx, ku;\n\n                switch ( m ) {\n                    case 'generateKey':\n                        ka = alg(a), kx = b, ku = c;\n                        break;\n                    case 'importKey':\n                        ka = alg(c), kx = args[3], ku = args[4];\n                        if ( a === 'jwk' ) {\n                            b = b2jwk(b);\n                            if ( !b.alg ) b.alg = jwkAlg(ka);\n                            if ( !b.key_ops ) b.key_ops = ( b.kty !== 'oct' ) ? ( 'd' in b ) ? ku.filter(isPrvKeyUse) : ku.filter(isPubKeyUse) : ku.slice();\n                            args[1] = jwk2b(b);\n                        }\n                        break;\n                    case 'unwrapKey':\n                        ka = args[4], kx = args[5], ku = args[6];\n                        args[2] = c._key;\n                        break;\n                }\n\n                if ( m === 'generateKey' && ka.name === 'HMAC' && ka.hash ) {\n                    ka.length = ka.length || { 'SHA-1': 512, 'SHA-256': 512, 'SHA-384': 1024, 'SHA-512': 1024 }[ka.hash.name];\n                    return _subtle.importKey( 'raw', _crypto.getRandomValues( new Uint8Array( (ka.length+7)>>3 ) ), ka, kx, ku );\n                }\n\n                if ( isWebkit && m === 'generateKey' && ka.name === 'RSASSA-PKCS1-v1_5' && ( !ka.modulusLength || ka.modulusLength >= 2048 ) ) {\n                    a = alg(a), a.name = 'RSAES-PKCS1-v1_5', delete a.hash;\n                    return _subtle.generateKey( a, true, [ 'encrypt', 'decrypt' ] )\n                        .then( function ( k ) {\n                            return Promise.all([\n                                _subtle.exportKey( 'jwk', k.publicKey ),\n                                _subtle.exportKey( 'jwk', k.privateKey ),\n                            ]);\n                        })\n                        .then( function ( keys ) {\n                            keys[0].alg = keys[1].alg = jwkAlg(ka);\n                            keys[0].key_ops = ku.filter(isPubKeyUse), keys[1].key_ops = ku.filter(isPrvKeyUse);\n                            return Promise.all([\n                                _subtle.importKey( 'jwk', keys[0], ka, true, keys[0].key_ops ),\n                                _subtle.importKey( 'jwk', keys[1], ka, kx, keys[1].key_ops ),\n                            ]);\n                        })\n                        .then( function ( keys ) {\n                            return {\n                                publicKey: keys[0],\n                                privateKey: keys[1],\n                            };\n                        });\n                }\n\n                if ( ( isWebkit || ( isIE && ( ka.hash || {} ).name === 'SHA-1' ) )\n                        && m === 'importKey' && a === 'jwk' && ka.name === 'HMAC' && b.kty === 'oct' ) {\n                    return _subtle.importKey( 'raw', s2b( a2s(b.k) ), c, args[3], args[4] );\n                }\n\n                if ( isWebkit && m === 'importKey' && ( a === 'spki' || a === 'pkcs8' ) ) {\n                    return _subtle.importKey( 'jwk', pkcs2jwk(b), c, args[3], args[4] );\n                }\n\n                if ( isIE && m === 'unwrapKey' ) {\n                    return _subtle.decrypt( args[3], c, b )\n                        .then( function ( k ) {\n                            return _subtle.importKey( a, k, args[4], args[5], args[6] );\n                        });\n                }\n\n                var op;\n                try {\n                    op = _fn.apply( _subtle, args );\n                }\n                catch ( e ) {\n                    return Promise.reject(e);\n                }\n\n                if ( isIE ) {\n                    op = new Promise( function ( res, rej ) {\n                        op.onabort =\n                        op.onerror =    function ( e ) { rej(e)               };\n                        op.oncomplete = function ( r ) { res(r.target.result) };\n                    });\n                }\n\n                op = op.then( function ( k ) {\n                    if ( ka.name === 'HMAC' ) {\n                        if ( !ka.length ) ka.length = 8 * k.algorithm.length;\n                    }\n                    if ( ka.name.search('RSA') == 0 ) {\n                        if ( !ka.modulusLength ) ka.modulusLength = (k.publicKey || k).algorithm.modulusLength;\n                        if ( !ka.publicExponent ) ka.publicExponent = (k.publicKey || k).algorithm.publicExponent;\n                    }\n                    if ( k.publicKey && k.privateKey ) {\n                        k = {\n                            publicKey: new CryptoKey( k.publicKey, ka, kx, ku.filter(isPubKeyUse) ),\n                            privateKey: new CryptoKey( k.privateKey, ka, kx, ku.filter(isPrvKeyUse) ),\n                        };\n                    }\n                    else {\n                        k = new CryptoKey( k, ka, kx, ku );\n                    }\n                    return k;\n                });\n\n                return op;\n            }\n        });\n\n    [ 'exportKey', 'wrapKey' ]\n        .forEach( function ( m ) {\n            var _fn = _subtle[m];\n\n            _subtle[m] = function ( a, b, c ) {\n                var args = [].slice.call(arguments);\n\n                switch ( m ) {\n                    case 'exportKey':\n                        args[1] = b._key;\n                        break;\n                    case 'wrapKey':\n                        args[1] = b._key, args[2] = c._key;\n                        break;\n                }\n\n                if ( ( isWebkit || ( isIE && ( b.algorithm.hash || {} ).name === 'SHA-1' ) )\n                        && m === 'exportKey' && a === 'jwk' && b.algorithm.name === 'HMAC' ) {\n                    args[0] = 'raw';\n                }\n\n                if ( isWebkit && m === 'exportKey' && ( a === 'spki' || a === 'pkcs8' ) ) {\n                    args[0] = 'jwk';\n                }\n\n                if ( isIE && m === 'wrapKey' ) {\n                    return _subtle.exportKey( a, b )\n                        .then( function ( k ) {\n                            if ( a === 'jwk' ) k = s2b( unescape( encodeURIComponent( JSON.stringify( b2jwk(k) ) ) ) );\n                            return  _subtle.encrypt( args[3], c, k );\n                        });\n                }\n\n                var op;\n                try {\n                    op = _fn.apply( _subtle, args );\n                }\n                catch ( e ) {\n                    return Promise.reject(e);\n                }\n\n                if ( isIE ) {\n                    op = new Promise( function ( res, rej ) {\n                        op.onabort =\n                        op.onerror =    function ( e ) { rej(e)               };\n                        op.oncomplete = function ( r ) { res(r.target.result) };\n                    });\n                }\n\n                if ( m === 'exportKey' && a === 'jwk' ) {\n                    op = op.then( function ( k ) {\n                        if ( ( isWebkit || ( isIE && ( b.algorithm.hash || {} ).name === 'SHA-1' ) )\n                                && b.algorithm.name === 'HMAC') {\n                            return { 'kty': 'oct', 'alg': jwkAlg(b.algorithm), 'key_ops': b.usages.slice(), 'ext': true, 'k': s2a( b2s(k) ) };\n                        }\n                        k = b2jwk(k);\n                        if ( !k.alg ) k['alg'] = jwkAlg(b.algorithm);\n                        if ( !k.key_ops ) k['key_ops'] = ( b.type === 'public' ) ? b.usages.filter(isPubKeyUse) : ( b.type === 'private' ) ? b.usages.filter(isPrvKeyUse) : b.usages.slice();\n                        return k;\n                    });\n                }\n\n                if ( isWebkit && m === 'exportKey' && ( a === 'spki' || a === 'pkcs8' ) ) {\n                    op = op.then( function ( k ) {\n                        k = jwk2pkcs( b2jwk(k) );\n                        return k;\n                    });\n                }\n\n                return op;\n            }\n        });\n\n    [ 'encrypt', 'decrypt', 'sign', 'verify' ]\n        .forEach( function ( m ) {\n            var _fn = _subtle[m];\n\n            _subtle[m] = function ( a, b, c, d ) {\n                if ( isIE && ( !c.byteLength || ( d && !d.byteLength ) ) )\n                    throw new Error(\"Empy input is not allowed\");\n\n                var args = [].slice.call(arguments),\n                    ka = alg(a);\n\n                if ( isIE && m === 'decrypt' && ka.name === 'AES-GCM' ) {\n                    var tl = a.tagLength >> 3;\n                    args[2] = (c.buffer || c).slice( 0, c.byteLength - tl ),\n                    a.tag = (c.buffer || c).slice( c.byteLength - tl );\n                }\n\n                args[1] = b._key;\n\n                var op;\n                try {\n                    op = _fn.apply( _subtle, args );\n                }\n                catch ( e ) {\n                    return Promise.reject(e);\n                }\n\n                if ( isIE ) {\n                    op = new Promise( function ( res, rej ) {\n                        op.onabort =\n                        op.onerror = function ( e ) {\n                            rej(e);\n                        };\n\n                        op.oncomplete = function ( r ) {\n                            var r = r.target.result;\n\n                            if ( m === 'encrypt' && r instanceof AesGcmEncryptResult ) {\n                                var c = r.ciphertext, t = r.tag;\n                                r = new Uint8Array( c.byteLength + t.byteLength );\n                                r.set( new Uint8Array(c), 0 );\n                                r.set( new Uint8Array(t), c.byteLength );\n                                r = r.buffer;\n                            }\n\n                            res(r);\n                        };\n                    });\n                }\n\n                return op;\n            }\n        });\n\n    if ( isIE ) {\n        var _digest = _subtle.digest;\n\n        _subtle['digest'] = function ( a, b ) {\n            if ( !b.byteLength )\n                throw new Error(\"Empy input is not allowed\");\n\n            var op;\n            try {\n                op = _digest.call( _subtle, a, b );\n            }\n            catch ( e ) {\n                return Promise.reject(e);\n            }\n\n            op = new Promise( function ( res, rej ) {\n                op.onabort =\n                op.onerror =    function ( e ) { rej(e)               };\n                op.oncomplete = function ( r ) { res(r.target.result) };\n            });\n\n            return op;\n        };\n\n        global.crypto = Object.create( _crypto, {\n            getRandomValues: { value: function ( a ) { return _crypto.getRandomValues(a) } },\n            subtle:          { value: _subtle },\n        });\n\n        global.CryptoKey = CryptoKey;\n    }\n\n    if ( isWebkit ) {\n        _crypto.subtle = _subtle;\n\n        global.Crypto = _Crypto;\n        global.SubtleCrypto = _SubtleCrypto;\n        global.CryptoKey = CryptoKey;\n    }\n}\n"]},"metadata":{},"sourceType":"script"}